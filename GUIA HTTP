El Escenario del Examen (Hipotético)
IP del Servidor DMZ: 192.168.50.10

Dominio 1 (Corporativo): www.empresa.net (Debe tener un alias web.empresa.net).

Dominio 2 (Servicios): www.servicios.com.

Restricción de Seguridad: El acceso al directorio /admin en www.servicios.com solo debe permitirse desde la IP del administrador en la LAN (192.168.1.50).

HTTPS (Opcional pero probable): A veces piden habilitar SSL básico.

Cambios Necesarios en tu Script
Rutas de Logs: Apache necesita que el usuario www-data tenga permisos o que los directorios existan antes de reiniciar, si no, fallará.

Seguridad por IP: Es vital en una DMZ demostrar que sabes restringir acceso.

Limpieza de Sites: Es buena práctica desactivar el sitio por defecto (000-default).

Si el examen es sobre una infraestructura completa (Firewall + DMZ), no olvides estos 3 puntos:

Archivo /etc/hosts en el cliente: Para probar que funciona desde fuera, el cliente debe apuntar a la IP de la DMZ: 192.168.50.10 www.empresa.net www.servicios.com

Reglas de Firewall (iptables/nftables): Si hay un firewall delante, debes abrir el puerto 80 hacia la IP de la DMZ: iptables -A FORWARD -p tcp --dport 80 -d 192.168.50.10 -j ACCEPT

Verificación de logs en tiempo real: Si el profesor te pide demostrar que el bloqueo por IP funciona, intenta entrar a /admin desde una IP no autorizada y muéstrale el log: tail -f /var/log/apache2/servicios-error.log (verás un "client denied by server configuration").









Esta es una solicitud más compleja ya que implica dos escenarios distintos: el servidor DMZ (público, VirtualHosts estándar y alias de directorios) y el servidor Intranet (privacidad, autenticación de usuarios y ejecución de scripts CGI).

Para que sea práctico, he diseñado un script para cada servidor que cumple con todos los requerimientos de tu guía.

1. Servidor DMZ (Segona Part)
Este script configura las dos webs (primernomdedomini.com y segonnomdedomini.org), crea la estructura de carpetas, los alias de imágenes y las páginas de error 404 personalizadas.

2. Servidor Intranet (Tercera Part)
Este script es más avanzado: configura el módulo CGI para los scripts bash, crea los usuarios con htpasswd y restringe el acceso por IP (reemplaza 192.168.1.0/24 por tu red real).

3. Checklist para HTTP (DMZ e Intranet)
Para los requerimientos específicos que mencionaba tu guía, ten presente esto:

Páginas de Error: Si te piden un mensaje de error 404 personalizado, debes añadir esta línea dentro del bloque <VirtualHost>:

ErrorDocument 404 /404.html (y asegúrate de que el archivo exista en el DocumentRoot).

Alias de Directorios: Si te piden que /fotos apunte a una carpeta fuera de la web:

Alias /fotos /ruta/fuera/de/la/web

CGI (Scripts): Si te piden que los scripts funcionen, no olvides activar el módulo:

sudo a2enmod cgi

Y añadir Options +ExecCGI y AddHandler cgi-script .sh en la configuración del directorio.


4. Variables Críticas (Lo que cambia seguro)
En cualquier script o configuración manual, tendrás que localizar y sustituir estos tres bloques:

Identidad del Servidor:

ServerName: El dominio principal (ej: www.examen.com).

ServerAlias: Otros nombres (ej: examen.com o www2.examen.com).

ServerAdmin: El correo que te pida el profesor.

Rutas de Archivos:

DocumentRoot: La carpeta donde están los .html. Asegúrate de que la ruta sea exactamente la que pida el enunciado (ej: /var/www/html/web1).

Red y Seguridad:

Require ip: Cambia la IP de red (ej: 192.168.10.0/24) por la de la VLAN que te asignen.

SSLCertificateFile: Si es HTTPS, asegúrate de que la ruta apunte al archivo .crt que generes.
